<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="HANA,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0">






<meta name="description" content="The SAP HANA SystemThe SAP HANA system consists of multiple servers:The most important component is the index server. The index server contains the in-memory data stores and the engines for processing">
<meta name="keywords" content="HANA">
<meta property="og:type" content="article">
<meta property="og:title" content="SAP HANA System Architecture Overview">
<meta property="og:url" content="https://necusjz.github.io/p/4217441451.html">
<meta property="og:site_name" content="Ethan&#39;s Blog">
<meta property="og:description" content="The SAP HANA SystemThe SAP HANA system consists of multiple servers:The most important component is the index server. The index server contains the in-memory data stores and the engines for processing">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://raw.githubusercontent.com/necusjz/p/master/HANA/3-1.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/necusjz/p/master/HANA/3-2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/necusjz/p/master/HANA/3-3.jpg">
<meta property="og:updated_time" content="2025-05-15T06:06:15.859Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SAP HANA System Architecture Overview">
<meta name="twitter:description" content="The SAP HANA SystemThe SAP HANA system consists of multiple servers:The most important component is the index server. The index server contains the in-memory data stores and the engines for processing">
<meta name="twitter:image" content="https://raw.githubusercontent.com/necusjz/p/master/HANA/3-1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://necusjz.github.io/p/4217441451.html">





  <title> SAP HANA System Architecture Overview | Ethan's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ethan's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://necusjz.github.io/p/4217441451.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="necusjz">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ethan's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                SAP HANA System Architecture Overview
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-04T00:21:10+10:00">
                2019-07-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="The-SAP-HANA-System"><a href="#The-SAP-HANA-System" class="headerlink" title="The SAP HANA System"></a>The SAP HANA System</h2><p>The SAP HANA system consists of multiple servers:<br><img src="https://raw.githubusercontent.com/necusjz/p/master/HANA/3-1.jpg" alt><br>The most important component is the <code>index server</code>. The index server contains the in-memory data stores and the <strong>engines for processing the data</strong>.<br>The <code>name server</code> owns the information about the topology of an SAP HANA system. In a distributed system, the name server <strong>knows where the components are running</strong>, and which data is located on which server.</p>
<a id="more"></a>
<p>The <code>XS</code> runtime is the application server for native SAP HANA-based web applications. It is installed with the SAP HANA system and allows developers to write and run SAP HANA-based applications <strong>without the need to run an additional application server</strong>.<br>The <code>extended store server</code> is part of the <strong>dynamic tiering</strong> option. Less frequently accessed data, which you do not want to keep in main memory, can be put into the extended store. With dynamic tiering, SAP HANA can host very big databases with reduced cost of ownership.<br>The <code>data provisioning server</code> is part of <strong>Enterprise Information Management</strong> (EIM) in SAP HANA. It provides capabilities such as data provisioning in real time and batch mode, real-time data transformations, data quality functions.<br>The <code>streaming cluster</code> is part of the <strong>smart data streaming</strong> option. Smart data streaming extends SAP HANA with capabilities of SAP Event Stream Processor for consuming data streams and complex event processing.<br>The <code>HDI server</code> is a <strong>separate server process</strong> that is part of the HANA deployment infrastructure.<br>The <strong>SAP HANA server software</strong> is developed mainly in C++ and runs on the Linux operation system. The <strong>XS Advanced on-premise platform components</strong> are developed in Java.</p>
<h2 id="SAP-HANA-Tools"><a href="#SAP-HANA-Tools" class="headerlink" title="SAP HANA Tools"></a>SAP HANA Tools</h2><p>Traditionally, the <strong>Eclipse-based</strong> SAP <code>HANA Studio</code> has been the development environment and administration tool for SAP HANA. The studio is superseded by <strong>web-based tools</strong>, which are grouped in the following three categories:</p>
<ul>
<li>Administration Tools<br>Web-based administration tools for SAP HANA are available in the SAP <code>HANA Cockpit</code>. The cockpit is an SAP Fiori launchpad site that integrates various tools for administration, monitoring, and software life-cycle management.</li>
<li>Development Tools<br>SAP <code>Web IDE</code> for SAP HANA is the browser-based development environment for SAP HANA-based application. It covers various aspects of development, such as editing, modeling, versioning, build, deployment, and debugging. It is based on <strong>XS Advanced</strong> and HDI and uses Git for source code management.<br>SAP Web IDE for SAP HANA supersedes the SAP HANA <code>Web Workbench</code>, which can be used to develop SAP HANA-based applications for <strong>XS Classic</strong>.</li>
<li>Runtime Tools<br>The web-based SAP HANA runtime tools contain functions that are <strong>needed by both developers and administrators</strong>. Example are the SAP HANA database catalog browser, the SQL console and the Plan Visualizer for inspecting query execution plans.</li>
</ul>
<h2 id="Distributed-SAP-HANA-Systems"><a href="#Distributed-SAP-HANA-Systems" class="headerlink" title="Distributed SAP HANA Systems"></a>Distributed SAP HANA Systems</h2><p>SAP HANA supports distribution of its server components <strong>across multiple hosts</strong> – for example for scalability and availability.<br><img src="https://raw.githubusercontent.com/necusjz/p/master/HANA/3-2.jpg" alt><br>An installed SAP HANA system is identified by a <strong>System ID</strong> (SID). It is perceived as one unit from the perspective of <code>the administrator</code>, who can install, update, start up, shut down, or backup the system as a whole. The different components of the system share the same metadata, and requests from client applications are transparently dispatched to different servers in system, if required:</p>
<ul>
<li>A distributed SAP HANA <code>system</code> is installed on more than one host. Otherwise it is a <strong>single-host system</strong>.</li>
<li>A <code>host</code> is <strong>a machine</strong> which runs parts of the SAP HANA system.</li>
<li>A SAP HANA <code>instance</code> is the <strong>set of components</strong> of a distributed system that are installed on one host.</li>
</ul>
<p>The streaming cluster nodes and the extended store servers run on <strong>their own dedicated hosts</strong>, at least in product systems. This means that you <strong>always need a distributed system</strong> if you run one of these options in production.</p>
<h2 id="The-Index-Server"><a href="#The-Index-Server" class="headerlink" title="The Index Server"></a>The Index Server</h2><p>This section presents an overview of the architecture of the index server:<br><img src="https://raw.githubusercontent.com/necusjz/p/master/HANA/3-3.jpg" alt><br>The <code>Connection and Session Management</code> component at the top creates and manages sessions and connections for the <code>Database Clients</code>. Once a session is established, database clients typically use <strong>SQL statements</strong> to communicate with the index server. Analytical applications may use <strong>MDX queries</strong> (MultiDimensional eXpressions). SQL statements and MDX queries are sent over the same connection using the <strong>same network communication protocol</strong>.<br>The <code>Authentication</code> component is invoked when a new connection is established. Users are authenticated either by the SAP HANA system itself or external provider. The <code>Authorization Manager</code> is invoked by other components to check whether the user has the <strong>required privileges</strong> to execute the requested operations.<br>Each statement is processed in the context of a transaction. The <code>Transaction Manager</code> is the component that coordinates transaction, controls transactional isolation, and keeps track of running and closed transactions. The transaction manager cooperates with the persistence layer to <strong>achieve atomic and durable transactions</strong>.<br>The client requests are analyzed and executed by the set of components summarized as <code>Request Processing and Execution Control</code>. SAP HANA offers <strong>rich programming capabilities</strong> for running application-specific calculations inside the database system. In addition to SQL and MDX, SAP HANA provides its own programming languages for different use cases.<br>Incoming <strong>SQL requests</strong> are received by the <code>SQL Processor</code>. Data manipulation statements are executed by the SQL processor itself. Other types of requests are delegated to the respective components:</p>
<ul>
<li>Data definition statements are dispatched to the <strong>metadata manager</strong>.</li>
<li>Transaction control statements are forwarded to the <strong>transaction manager</strong>.</li>
<li>Planning commands are routed to the <strong>planning engine</strong>.</li>
<li>Task related commands are forwarded to the <code>Task Manager</code>.</li>
</ul>
<p>Incoming <strong>MDX requests</strong> are delegated to the <code>MDX Processor</code>. Procedure calls are forwarded to the <code>Procedure Processor</code>, which further dispatches the calls, for example to the calculation engine, the <code>Graph Engine</code>, the repository, or the HDI proxy. Procedures are also used to call liveCache functions.<br>The index server also contains a component called the <code>Planning Engine</code> that allows planning applications. It is mainly used for planning in SAP <strong>Business Warehouse</strong> (BW).<br>The SAP HANA <strong>Enterprise Performance Management</strong> (EPM) platform provides the infrastructure for developing and running enterprise performance management application on SAP HANA. The <code>EPM Runtime</code> is a central component of the EPM platform. While the planning engine provides basic planning operations, the EPM platform <strong>provides the foundation</strong> for complete planning application. It is usually invoked directly by an <strong>XS-based service</strong>.</p>
<blockquote>
<p>While the planning engine is mainly used for planning in BW, the EPM platform addresses planning and simulation applications in general.</p>
</blockquote>
<p>The SQL processor, the MDX processor, the planning engine and the task framework, translate the different programming languages, query languages, and models into <strong>common representation that is optimized and executed</strong> by the <code>Calculation Engine</code>.<br>Metadata can be accessed via <code>Metadata Manager</code> component. Metadata <strong>comprises a variety of objects</strong>, such as definitions of relational tables, columns, views, indexes and procedures. In distributed systems, central metadata is shared across servers.<br>The row store, column store, and the federation component are <code>Relational Stores</code>, which provide access to data organized in  relational tables:</p>
<ul>
<li>The <code>Column Store</code> stores relational tables column-wise. The column store also contains the <strong>text search</strong> and analysis capabilities, support for <strong>spatial data</strong>, and operators and storage for graph-structured data.</li>
<li>The <code>Row Store</code> stores relational tables row-wise. When a table is created, the creator needs to specify whether it should be row or column-based. Tables can be <strong>migrated between the two storage formats</strong>.</li>
<li>The <code>Federation</code> component can be viewed as a <strong>virtual relational data store</strong>. It provides access to remote data in external systems through virtual tables, which can be used in SQL queries like normal tables. The data federation feature of SAP HANA is referred to as <strong>smart data access</strong>. The federation capabilities of smart data access are extended by <strong>Enterprise Information Management</strong> (EIM) in SAP HANA.</li>
<li>The SAP HANA database provides native support for storing and processing <strong>graph-structured data</strong>. However, technically it is <strong>not a separate physical data store</strong>. Instead it is built using the column store, which was extended with a dedicated graph API.</li>
<li>SAP HANA includes an integration of SAP liveCache technology into the index server. <code>liveCache in SAP HANA</code> is a <strong>non-relational, in-memory store</strong> with data represented as networks of C++ objects, which can be persisted to disk. Unlike the row store and column store, liveCache does not use relational tables. Instead the liveCache objects are <strong>directly stored in containers</strong> provided by the persistence layer.</li>
</ul>
<blockquote>
<p>The index server uses the federation infrastructure to send SQL statements to the extended store server.</p>
</blockquote>
<p>The <code>Persistence Layer</code> is responsible for durability and atomicity of transactions. It ensures that the database is <strong>restored to the most recent committed state</strong> after a restart and that transactions are either completely executed or completely undone. To achieve this goal in an efficient way, the persistence layer uses a combination of <strong>write-ahead logs, shadow paging and savepoints</strong>. It also contains the logger component that manages the transaction log.<br>The <code>HDI Proxy</code> is a small component which forwards requests to the DI server, the <strong>main component</strong> of the HDI. HDI supersedes the classic SAP HANA <code>Repository</code>. In general the repository contains design-time representations, which <strong>need to be activated</strong> to create the corresponding runtime objects.</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/HANA/" rel="tag"># HANA</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/p/2294393036.html" rel="next" title="Basic In-Memory Database Concepts">
                <i class="fa fa-chevron-left"></i> Basic In-Memory Database Concepts
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/p/2587689479.html" rel="prev" title="The Programmer's View of SAP HANA">
                The Programmer's View of SAP HANA <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="necusjz">
          <p class="site-author-name" itemprop="name">necusjz</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">279</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-SAP-HANA-System"><span class="nav-number">1.</span> <span class="nav-text">The SAP HANA System</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SAP-HANA-Tools"><span class="nav-number">2.</span> <span class="nav-text">SAP HANA Tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Distributed-SAP-HANA-Systems"><span class="nav-number">3.</span> <span class="nav-text">Distributed SAP HANA Systems</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Index-Server"><span class="nav-number">4.</span> <span class="nav-text">The Index Server</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">necusjz</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


  

  

  

  


  

</body>
</html>
